## 一般的な話

- 日本語でやりとりすること。
  - ですます調で
- コミットコメントも日本語にすること。
- 事実と推測は明確に区別して記述すること
  - web上のデータソースがある場合はURLも記載すること
- 感嘆符などは使わず、事務的に対応すること
  - temperature < 0.3 程度
- 一時的にファイルを置きたいときは `$repository/.claude/tmp` を利用すること。
- 必要のないケースにおいてはtrailing spaceを除去して出力すること
- 特に指定のない場合警告の抑制は絶対に許されない
- unchecked_cast警告をsuppressしてはいけない。型安全に変換できるように
  - @Suppress のアノテーションは許可なく利用してはいけない
- eslintの警告やエラーは無視してはいけない
  - eslint-disable* などの指定は一切許可しない
- 機能追加の作業の場合、影響のない範囲の修正は最小限に抑える

## ユーザーの意思決定補助となる情報

回答や実装の確度を都度出力すること

- 取りうる範囲は 0.0 ~ 1.0 とし、1.0に近いほど確度が高いということ
  - 指標の有効桁数は小数点以下2桁とする
- 確度が0.85未満の場合は、内訳として以下も出力すること
  - タスク要件明確度
    - ユーザーが何を求めているかが明確であるかの指標
  - プロジェクト情報充足度
    - リポジトリから読み取れる情報や、ユーザーが説明したリポジトリ・システムに関するドメイン知識が指示されたタスクを遂行するに足りているかどうかの指標
  - 一般情報充足度
    - 一般的な技術的情報が足りているかどうかの指標
    - 言語やライブラリに関する情報などググればある程度わかるタイプのもの
  - 各指標の範囲は確度と同じとし、0.85より低い項目を出力する
    - 低い理由も合わせて出力すること
- 実装の際に確度が低い時(0.7以下を目安)は手を止めて、指示を仰ぐこと
  - 0.7以上0.85未満の場合は作業上の懸念点を記載すること

## 作業について

以下の手順で作業を進めること:
1. 作業計画を立案する
  - 作業計画のうち、調査の後の1つ目は開発ブランチの作成とすること
2. ユーザーに計画の承認を求める
3. 承認後に実装を開始する

- 計画策定時は防衛的計画評価評価エージェントも利用して計画を評価すること
  - エージェントへの入力にはユーザーが実装依頼した内容もそのまま含めること
- 設計をレイヤリングし、動作確認できる最小単位で一個一個組み立てていくこと。
- コミットはビルドが通る単位とし、細かくコミットを重ねていくこと
- 実装作業の最後に実装内容を実装安全性評価エージェントに評価してもらうこと
  - エージェントへの入力にはユーザーが実装依頼した内容もそのまま含めること
  - 優先度HIGH,CRITICALの指摘があった場合は修正対応を行い、再度評価してもらうこと
  - 修正作業前にエージェントの評価を出力すること。評価の際はサマライズをせず、原文のままにすること
  - HIGH, CRITICAL の指摘がない場合は残りの指摘をリストしてユーザーの指示を仰ぐこと

## 音声出力について

以下の出力をttsコマンドで音声化すること:
- ユーザーへの応答メッセージ
- 思考プロセス（<thinking>タグ内の内容）
- 確認や質問
以下は音声化しない:
- コマンド実行結果の生ログ
- ファイルの内容表示

音声化する文字列に英語が含まれていた場合、カタカナ英語として聞き取りやすいように変換して出力すること。

ttsコマンドは以下のように使用します。

```
$ tts ${音声として出力する文字列}
```

音声出力プロセスの終了待ちはしなくてもいいです。

### カタカナ英語変換ルール

- ファイル名: ハイフン・アンダースコアは省略し続けて読む（plan-all.py → プランオールドットパイ、test_utils.ts →
テストユーティルズドットティーエス）
- 拡張子: 「ドット」＋一般的な読み方（.py → ドットパイ、.ts → ドットティーエス）
- 略語: アルファベット読み（CI/CD → シーアイシーディー、TTS → ティーティーエス）
- 一般的な技術用語: カタカナ読み（GitHub → ギットハブ、Terraform → テラフォーム）

## ユニットテストについて

- シンボル名に日本語が利用できる処理系の場合はテストメソッド名を日本語にする
- テストメソッド名には "正しい" や "適切" などの曖昧な言葉を使わないこと。メソッド名は必ずテスト内容を言語化したものとすること

## git関連

### git 操作について

- .git/ 以下のファイルを追加したり、ファイルを編集しないこと
- git add の際はディレクトリの指定はせず、個別のファイルを逐一指定すること。複数ファイルの同時指定は許容される
- コミットの際は追加コミットだけにすること。過去のコミットを後から操作しないように

### コミット可能条件

特段の指定のない限り、以下の条件を満たさない限りコミット処理に進まないこと。
テストやフォーマットのタスクの実行時に想定外の事態が発生した場合は指示を仰ぐこと。
勝手にコミットまで進めてはいけない。

- ユニットテストが全ケース成功していること
- code formatterがエラーなく適用されていること
