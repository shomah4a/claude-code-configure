## 一般的な話

- 日本語でやりとりすること。
- コミットコメントも日本語にすること。
- 事実と推測は明確に区別して記述すること
  - web上のデータソースがある場合はURLも記載すること
- 感嘆符などは使わず、事務的に対応すること
  - temperature < 0.3 程度
- 一時的にファイルを置きたいときは `$repository/.claude/tmp` を利用すること。
- 必要のないケースにおいてはtrailing spaceを除去して出力すること
- 特に指定のない場合警告の抑制は絶対に許されない
- unchecked_cast警告をsuppressしてはいけない。型安全に変換できるように
  - @Suppress のアノテーションは許可なく利用してはいけない
- eslintの警告やエラーは無視してはいけない
  - eslint-disable* などの指定は一切許可しない
- 機能追加の作業の場合、影響のない範囲の修正は最小限に抑える

## ユーザーの意思決定補助となる情報

回答や実装の確度を都度出力すること

- 取りうる範囲は 0.0 ~ 1.0 とし、1.0に近いほど確度が高いということ
  - 指標の有効桁数は小数点以下2桁とする
- 確度が0.85未満の場合は、内訳として以下も出力すること
  - タスク要件明確度
    - ユーザーが何を求めているかが明確であるかの指標
  - プロジェクト情報充足度
    - リポジトリから読み取れる情報や、ユーザーが説明したリポジトリ・システムに関するドメイン知識が指示されたタスクを遂行するに足りているかどうかの指標
  - 一般情報充足度
    - 一般的な技術的情報が足りているかどうかの指標
    - 言語やライブラリに関する情報などググればある程度わかるタイプのもの
  - 各指標の範囲は確度と同じとし、0.85より低い項目を出力する
    - 低い理由も合わせて出力すること
- 実装の際に確度が低い時(0.7以下を目安)は手を止めて、指示を仰ぐこと
  - 0.7以上0.85未満の場合は作業上の懸念点を記載すること

## 作業について

以下の手順で作業を進めること:
1. 作業計画を立案する
  - 作業計画のうち、調査の後の1つ目は開発ブランチの作成とすること
2. ユーザーに計画の承認を求める
3. 承認後に実装を開始する

- 計画策定時は防衛的計画評価評価エージェントも利用して計画を評価すること
  - エージェントへの入力にはユーザーが実装依頼した内容もそのまま含めること
- 設計をレイヤリングし、動作確認できる最小単位で一個一個組み立てていくこと。
- コミットはビルドが通る単位とし、細かくコミットを重ねていくこと
- 実装作業の最後に実装内容を実装安全性評価エージェントに評価してもらうこと
  - エージェントへの入力にはユーザーが実装依頼した内容もそのまま含めること
  - 優先度HIGH,CRITICALの指摘があった場合は修正対応を行い、再度評価してもらうこと
  - 修正作業前にエージェントの評価を出力すること。評価の際はサマライズをせず、原文のままにすること
  - HIGH, CRITICAL の指摘がない場合は残りの指摘をリストしてユーザーの指示を仰ぐこと

## 音声出力について

以下の出力をttsコマンドで音声化すること:
- ユーザーへの応答メッセージ
- 思考プロセス（<thinking>タグ内の内容）
- 確認や質問
以下は音声化しない:
- コマンド実行結果の生ログ
- ファイルの内容表示

ttsコマンドは以下のように使用します。

```
$ tts ${音声として出力する文字列}
```

音声出力プロセスの終了待ちはしなくてもいいです。

## ユニットテストについて

- シンボル名に日本語が利用できる処理系の場合はテストメソッド名を日本語にする
- テストメソッド名には "正しい" や "適切" などの曖昧な言葉を使わないこと。メソッド名は必ずテスト内容を言語化したものとすること

## git関連

### git 操作について

- .git/ 以下のファイルを追加したり、ファイルを編集しないこと
- git add の際はディレクトリの指定はせず、個別のファイルを逐一指定すること。複数ファイルの同時指定は許容される
- コミットの際は追加コミットだけにすること。過去のコミットを後から操作しないように

### コミット可能条件

特段の指定のない限り、以下の条件を満たさない限りコミット処理に進まないこと。
テストやフォーマットのタスクの実行時に想定外の事態が発生した場合は指示を仰ぐこと。
勝手にコミットまで進めてはいけない。

- ユニットテストが全ケース成功していること
- code formatterがエラーなく適用されていること

## 作業ログについて

以下に定義する

- 作業フィードバックログ
- ナレッジログ
- プロンプトログ

の3つをあわせて「三点セットログ」といいます。


### 作業フィードバックについて

ユーザーの求めに応じて作業指示のフィードバックを $HOME/.claude/prompt-report/ にmarkdownで書き出すこと。
書き出す際のファイル名は時系列ソートしやすいように `yyyy-mm-dd_HH-MM_` prefix をつけること。
daily-serial はその日の何番目なのかがわかりやすいようにインクリメントしていってください。
prefixのあとは作業概要を簡潔にまとめた名前をつけてください。

#### フィードバックの内容・目的

- ジュニアエンジニア（CS系卒・半年程度のキャリア）への指示改善が目的
- コードベースへの理解はある程度あるものと想定
- 開発サイクル（ブランチ作成〜完了）単位でフィードバックを実施
- ユーザーが明示的にフィードバックを求めた時に作成

#### 含めるべき内容

- 指示で曖昧だった点の具体的な指摘
- 最終成果物から逆算した、より効率的な指示例
- 意図が正しく伝わったか/伝わらなかった部分の分析
- レポート体裁で、自由フォーマット

### ナレッジ書き出し

ユーザーの求めに応じて対話セッション中で新しく認識したリポジトリの構造やルールについて書き出してください。
書き出し先は各リポジトリの `$HOME/.claude/knowledge/${repo_name}/YYYY-mm-dd_HH-MM_$description.md` とします。

#### 記録すべき内容

AIがソースコードから推測した内容とユーザーの実際の認識のギャップが発生した場合、それを優先的に記録する。

具体的には：
- プロジェクトの設計思想や意図でソースコードからは読み取れないもの
- コード構造の背景にある理由
- 運用上の制約や慣習
- ビジネスロジックの前提条件
- 暗黙のルールや例外的な扱い

#### 記録の意義

これらのギャップはソースコードからの認知が困難な箇所を示しており、ドキュメント整備が必要な箇所の特定に繋がる。


### プロンプトログの書き出し

ユーザーの求めに応じて対話セッション中のログを書き出してください。長い入力であっても省略しないでください。
書き出し先は `$HOME/.claude/prompt-log/${repo_name}/YYYY-mm-dd_HH-MM_$description.md` とします。

目的としては、開発の再現性担保のためにpull requestに「このような対話によって生成されました」というログを書き込んでおくためのものです。

内容としては
- ユーザーの入力
- あなたの出力結果の概要
- ユーザーに対する確認を求める内容の場合は確認内容

などを含めてください。
